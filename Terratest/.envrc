###### INSTALL TERRAFORM && GO ######
apk update && apk add go wget zip

wget -q https://releases.hashicorp.com/terraform/1.3.3/terraform_1.3.3_linux_amd64.zip
unzip terraform_1.3.3_linux_amd64.zip && rm terraform_1.3.3_linux_amd64.zip
mv terraform /usr/bin/terraform

###### VAULT LOGIN #####
export VAULT_ADDR=$1
export VAULT_ROLE_ID=$2
export VAULT_SECRET_ID=$3
export VAULT_TOKEN=$(vault write -field=token $4 role_id=$VAULT_ROLE_ID secret_id=$VAULT_SECRET_ID) || true

#### OTC CREDENTIALS #####
export OS_DOMAIN_NAME=$5
export OS_ACCESS_KEY=$(vault kv get --field access_key $6)
export OS_SECRET_KEY=$(vault kv get --field secret_key $6)

export TF_VAR_region=$7
export OS_AUTH_URL="https://iam.${TF_VAR_region}.otc.t-systems.com/v3"

export AWS_ACCESS_KEY_ID=$OS_ACCESS_KEY
export AWS_SECRET_ACCESS_KEY=$OS_SECRET_KEY

##### PROJECT CONFIGURATION #####
#Current Context you are working on can be customer name or cloud name etc.
export TF_VAR_domain_name="terratest.iits.tech"
export TF_VAR_stage="test"
export OS_PROJECT_NAME=$TF_VAR_region"_terratest"

#### TERRAFORM LOCAL PLUGIN CACHING #####
mkdir -p ${HOME}/Terraform/plugins
export TF_PLUGIN_CACHE_DIR=${HOME}/Terraform/plugins